<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Comment Bot · Registrator.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>Registrator.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">Home</a></li><li><a class="toctext" href="../hosting/">Hosting Your Own</a></li><li><a class="toctext" href="../docker/">Using Docker</a></li><li class="current"><a class="toctext" href>Comment Bot</a><ul class="internal"><li><a class="toctext" href="#Configuring-the-Machine-1">Configuring the Machine</a></li><li><a class="toctext" href="#A-Bot-Account-1">A Bot Account</a></li><li><a class="toctext" href="#The-GitHub-App-1">The GitHub App</a></li></ul></li><li><a class="toctext" href="../webui/">Web UI</a></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Comment Bot</a></li></ul><a class="edit-page" href="https://github.com/JuliaRegistries/Registrator.jl/blob/master/docs/src/commentbot.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Comment Bot</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Registrator-Comment-Bot-1" href="#Registrator-Comment-Bot-1">Registrator Comment Bot</a></h1><p>Here we&#39;ll discuss hosting an instance of Registrator&#39;s comment bot on a local system behind a subnet for use with a registry other than General.</p><h2><a class="nav-anchor" id="Configuring-the-Machine-1" href="#Configuring-the-Machine-1">Configuring the Machine</a></h2><p>The relevant configuration settings here live in the <code>[commentbot]</code> section of <code>run/config.commentbot.toml</code>:</p><ul><li><code>http_port</code>: Set this to a port configured on the router to allow HTTP traffic that is not otherwise in use (e.g. not what is used for SSH access to the machine). This will be the port on which the comment bot service will listen for GitHub events.</li><li><code>http_ip</code>: This is the IP address of the host machine on its network. Note that this is NOT localhost, nor is it necessarily the machine&#39;s external IP.</li></ul><p>You can ensure that the host IP and port are configured properly by running the following on the host, substituting the appropriate values:</p><pre><code class="language-julia">using HTTP
HTTP.listen(http_ip, http_port) do _
    println(&quot;I hear you!&quot;)
end</code></pre><p>then entering the URL <code>http://&lt;http_ip&gt;:&lt;http_port&gt;</code> in a browser. If all goes well, the listener running on the server should print.</p><h2><a class="nav-anchor" id="A-Bot-Account-1" href="#A-Bot-Account-1">A Bot Account</a></h2><p>Since access to private repositories is required to work with a private registry, it&#39;s recommended to set up a &quot;bot&quot; account with limited permission within the organization. Authenticating as a user with elevated permissions may pose a security risk. Note that this is true regardless of whether the registry is private, since GitHub personal access tokens do not currently provide sufficiently granular access permissions.</p><p>Once such an account is created, create a personal access token for it for authentication.</p><p>In <code>run/config.commentbot.toml</code> in the <code>[commentbot.github]</code> section, set the following:</p><ul><li><code>user</code>: The GitHub username for the account.</li><li><code>token</code>: A personal access token for authenticating as this user.</li></ul><p>In the <code>[commentbot]</code> section, set <code>trigger</code> to <code>@&lt;user&gt;</code>.</p><h2><a class="nav-anchor" id="The-GitHub-App-1" href="#The-GitHub-App-1">The GitHub App</a></h2><p>A <a href="https://developer.github.com/apps/">GitHub App</a> is required to use the comment bot. In the organization settings, create a new GitHub App. Note that this App should be owned by the organization and not by the bot user in order to be installable without making it public.</p><p>Fill out the necessary fields in the app registration. For the webhook URL, use <code>http://&lt;http_ip&gt;:&lt;http_port&gt;</code>, where the values in brackets are what was entered into <code>run/config.commentbot.toml</code> when configuring the host machine. Enter a webhook secret and record the value you entered as <code>secret</code> in the <code>[commentbot.github]</code> section of <code>run/config.commentbot.toml</code>.</p><p>No organization or user permissions are required. For repository permissions, set at least:</p><ul><li>Contents: Read-only</li><li>Issues: Read-only</li><li>Metadata: Read-only</li><li>Commit statuses: Read-only</li></ul><p>Subscribe to commit and issue comments.</p><p>For private registries, ensure that the app is only installable on this account.</p><footer><hr/><a class="previous" href="../docker/"><span class="direction">Previous</span><span class="title">Using Docker</span></a><a class="next" href="../webui/"><span class="direction">Next</span><span class="title">Web UI</span></a></footer></article></body></html>
